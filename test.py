import re

from bs4 import BeautifulSoup

test_data = """
{"note":"","rtt":"194","responseBody":"<!DOCTYPE html>\n<html>\n    \n<head>\n        \n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n\n<!--<link rel=\"stylesheet\" type=\"text/css\" href=\"https://fonts.googleapis.com/css?family=Architects+Daughter\">-->\n<link rel=\"stylesheet\" type=\"text/css\" href=\"stylesheets/stylesheet.css\" media=\"screen\" />\n<link rel=\"shortcut icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\n\n<!--<script src=\"//html5shiv.googlecode.com/svn/trunk/html5.js\"><\/script>-->\n<script src=\"js/html5.js\"><\/script>\n\n<title>bWAPP - XSS<\/title>\n\n<\/head>\n\n<body>\n    \n<header>\n\n<h1>bWAPP<\/h1>\n\n<h2>an extremely buggy web app !<\/h2>\n\n<\/header>    \n\n<div id=\"menu\">\n      \n    <table>\n        \n        <tr>\n            \n            <td><a href=\"portal.php\">Bugs<\/a><\/td>\n            <td><a href=\"password_change.php\">Change Password<\/a><\/td>\n            <td><a href=\"user_extra.php\">Create User<\/a><\/td>\n            <td><a href=\"security_level_set.php\">Set Security Level<\/a><\/td>\n            <td><a href=\"reset.php\" onclick=\"return confirm('All settings will be cleared. Are you sure?');\">Reset<\/a><\/td>            \n            <td><a href=\"credits.php\">Credits<\/a><\/td>\n            <td><a href=\"http://itsecgames.blogspot.com\" target=\"_blank\">Blog<\/a><\/td>\n            <td><a href=\"logout.php\" onclick=\"return confirm('Are you sure you want to leave?');\">Logout<\/a><\/td>\n            <td><font color=\"red\">Welcome Bee<\/font><\/td>\n            \n        <\/tr>\n        \n    <\/table>\n   \n<\/div> \n\n<div id=\"main\">\n    \n    <h1>XSS - Stored (Blog)<\/h1>\n\n    <form action=\"/xss_stored_1.php\" method=\"POST\">\n\n\t<table>\n\n            <tr>\n\n                <td colspan=\"6\"><p><textarea name=\"entry\" id=\"entry\" cols=\"80\" rows=\"3\"><\/textarea><\/p><\/td>\n\n            <\/tr>\n\n            <tr>\n\n                <td width=\"79\" align=\"left\">\n\n                    <button type=\"submit\" name=\"blog\" value=\"submit\">Submit<\/button>\n\n                <\/td>\n\n                <td width=\"85\" align=\"center\">\n\n                    <label for=\"entry_add\">Add:<\/label>\n                    <input type=\"checkbox\" id=\"entry_add\" name=\"entry_add\" value=\"\" checked=\"on\">\n\n                <\/td>\n\n                <td width=\"100\" align=\"center\">\n\n                    <label for=\"entry_all\">Show all:<\/label>\n                    <input type=\"checkbox\" id=\"entry_all\" name=\"entry_all\" value=\"\">\n\n                <\/td>\n\n                <td width=\"106\" align=\"center\">\n\n                    <label for=\"entry_delete\">Delete:<\/label>\n                    <input type=\"checkbox\" id=\"entry_delete\" name=\"entry_delete\" value=\"\">\n\n                <\/td>\n\n                <td width=\"7\"><\/td>\n\n                <td align=\"left\"><font color=\"green\">Your entry was added to our blog!<\/font><\/td>\n\n            <\/tr>\n\n\t<\/table>\n\n    <\/form>\n\n    <br />\n\n    <table id=\"table_yellow\">\n\n        <tr height=\"30\" bgcolor=\"#ffb717\" align=\"center\">\n\n            <td width=\"20\">#<\/td>\n            <td width=\"100\"><b>Owner<\/b><\/td>\n            <td width=\"100\"><b>Date<\/b><\/td>\n            <td width=\"445\"><b>Entry<\/b><\/td>\n\n        <\/tr> \n\n        <tr height=\"40\">\n\n            <td align=\"center\">1<\/td>\n            <td>bee<\/td>\n            <td>2019-04-10 09:49:34<\/td>\n            <td>$attack_response<\/td>\n\n        <\/tr>\n\n    <\/table>\n\n<\/div>\n    \n<div id=\"side\">    \n    \n    <a href=\"http://twitter.com/MME_IT\" target=\"blank_\" class=\"button\"><img src=\"./images/twitter.png\"><\/a>\n    <a href=\"http://be.linkedin.com/in/malikmesellem\" target=\"blank_\" class=\"button\"><img src=\"./images/linkedin.png\"><\/a>\n    <a href=\"http://www.facebook.com/pages/MME-IT-Audits-Security/104153019664877\" target=\"blank_\" class=\"button\"><img src=\"./images/facebook.png\"><\/a>\n    <a href=\"http://itsecgames.blogspot.com\" target=\"blank_\" class=\"button\"><img src=\"./images/blogger.png\"><\/a>\n\n<\/div>     \n    \n<div id=\"disclaimer\">\n          \n    <p>bWAPP is licensed under <a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\" target=\"_blank\"><img style=\"vertical-align:middle\" src=\"./images/cc.png\"><\/a> &copy; 2014 MME BVBA / Follow <a href=\"http://twitter.com/MME_IT\" target=\"_blank\">@MME_IT<\/a> on Twitter and ask for our cheat sheet, containing all solutions! / Need an exclusive <a href=\"http://www.mmebvba.com\" target=\"_blank\">training<\/a>?<\/p>\n   \n<\/div>\n    \n<div id=\"bee\">\n    \n    <img src=\"./images/bee_1.png\">\n    \n<\/div>\n    \n<div id=\"security_level\">\n  \n    <form action=\"/xss_stored_1.php\" method=\"POST\">\n        \n        <label>Set your security level:<\/label><br />\n        \n        <select name=\"security_level\">\n            \n            <option value=\"0\">low<\/option>\n            <option value=\"1\">medium<\/option>\n            <option value=\"2\">high<\/option> \n            \n        <\/select>\n        \n        <button type=\"submit\" name=\"form_security_level\" value=\"submit\">Set<\/button>\n        <font size=\"4\">Current: <b>low<\/b><\/font>\n        \n    <\/form>   \n    \n<\/div>\n    \n<div id=\"bug\">\n\n    <form action=\"/xss_stored_1.php\" method=\"POST\">\n        \n        <label>Choose your bug:<\/label><br />\n        \n        <select name=\"bug\">\n   \n<option value='0'>----------------------  bWAPP v2.2  -----------------------<\/option><option value='1'>/ A1 - Injection /<\/option><option value='2'>HTML Injection - Reflected (GET)<\/option><option value='3'>HTML Injection - Reflected (POST)<\/option><option value='4'>HTML Injection - Reflected (Current URL)<\/option><option value='5'>HTML Injection - Stored (Blog)<\/option><option value='6'>iFrame Injection<\/option><option value='7'>LDAP Injection (Search)<\/option><option value='8'>Mail Header Injection (SMTP)<\/option><option value='9'>OS Command Injection<\/option><option value='10'>OS Command Injection - Blind<\/option><option value='11'>PHP Code Injection<\/option><option value='12'>Server-Side Includes (SSI) Injection<\/option><option value='13'>SQL Injection (GET/Search)<\/option><option value='14'>SQL Injection (GET/Select)<\/option><option value='15'>SQL Injection (POST/Search)<\/option><option value='16'>SQL Injection (POST/Select)<\/option><option value='17'>SQL Injection (AJAX/JSON/jQuery)<\/option><option value='18'>SQL Injection (CAPTCHA)<\/option><option value='19'>SQL Injection (Login Form/Hero)<\/option><option value='20'>SQL Injection (Login Form/User)<\/option><option value='21'>SQL Injection (SQLite)<\/option><option value='22'>SQL Injection (Drupal)<\/option><option value='23'>SQL Injection - Stored (Blog)<\/option><option value='24'>SQL Injection - Stored (SQLite)<\/option><option value='25'>SQL Injection - Stored (User-Agent)<\/option><option value='26'>SQL Injection - Stored (XML)<\/option><option value='27'>SQL Injection - Blind - Boolean-Based<\/option><option value='28'>SQL Injection - Blind - Time-Based<\/option><option value='29'>SQL Injection - Blind (SQLite)<\/option><option value='30'>SQL Injection - Blind (Web Services/SOAP)<\/option><option value='31'>XML/XPath Injection (Login Form)<\/option><option value='32'>XML/XPath Injection (Search)<\/option><option value='33'>/<\/option><option value='34'>/ A2 - Broken Auth. & Session Mgmt. /<\/option><option value='35'>Broken Authentication - CAPTCHA Bypassing<\/option><option value='36'>Broken Authentication - Forgotten Function<\/option><option value='37'>Broken Authentication - Insecure Login Forms<\/option><option value='38'>Broken Authentication - Logout Management<\/option><option value='39'>Broken Authentication - Password Attacks<\/option><option value='40'>Broken Authentication - Weak Passwords<\/option><option value='41'>Session Management - Administrative Portals<\/option><option value='42'>Session Management - Cookies (HTTPOnly)<\/option><option value='43'>Session Management - Cookies (Secure)<\/option><option value='44'>Session Management - Session ID in URL<\/option><option value='45'>Session Management - Strong Sessions<\/option><option value='46'>/<\/option><option value='47'>/ A3 - Cross-Site Scripting (XSS) /<\/option><option value='48'>Cross-Site Scripting - Reflected (GET)<\/option><option value='49'>Cross-Site Scripting - Reflected (POST)<\/option><option value='50'>Cross-Site Scripting - Reflected (JSON)<\/option><option value='51'>Cross-Site Scripting - Reflected (AJAX/JSON)<\/option><option value='52'>Cross-Site Scripting - Reflected (AJAX/XML)<\/option><option value='53'>Cross-Site Scripting - Reflected (Back Button)<\/option><option value='54'>Cross-Site Scripting - Reflected (Custom Header)<\/option><option value='55'>Cross-Site Scripting - Reflected (Eval)<\/option><option value='56'>Cross-Site Scripting - Reflected (HREF)<\/option><option value='57'>Cross-Site Scripting - Reflected (Login Form)<\/option><option value='58'>Cross-Site Scripting - Reflected (phpMyAdmin)<\/option><option value='59'>Cross-Site Scripting - Reflected (PHP_SELF)<\/option><option value='60'>Cross-Site Scripting - Reflected (Referer)<\/option><option value='61'>Cross-Site Scripting - Reflected (User-Agent)<\/option><option value='62'>Cross-Site Scripting - Stored (Blog)<\/option><option value='63'>Cross-Site Scripting - Stored (Change Secret)<\/option><option value='64'>Cross-Site Scripting - Stored (Cookies)<\/option><option value='65'>Cross-Site Scripting - Stored (SQLiteManager)<\/option><option value='66'>Cross-Site Scripting - Stored (User-Agent)<\/option><option value='67'>/<\/option><option value='68'>/ A4 - Insecure Direct Object References /<\/option><option value='69'>Insecure DOR (Change Secret)<\/option><option value='70'>Insecure DOR (Reset Secret)<\/option><option value='71'>Insecure DOR (Order Tickets)<\/option><option value='72'>/<\/option><option value='73'>/ A5 - Security Misconfiguration /<\/option><option value='74'>Arbitrary File Access (Samba)<\/option><option value='75'>Cross-Domain Policy File (Flash)<\/option><option value='76'>Cross-Origin Resource Sharing (AJAX)<\/option><option value='77'>Cross-Site Tracing (XST)<\/option><option value='78'>Denial-of-Service (Large Chunk Size)<\/option><option value='79'>Denial-of-Service (Slow HTTP DoS)<\/option><option value='80'>Denial-of-Service (SSL-Exhaustion)<\/option><option value='81'>Denial-of-Service (XML Bomb)<\/option><option value='82'>Insecure FTP Configuration<\/option><option value='83'>Insecure SNMP Configuration<\/option><option value='84'>Insecure WebDAV Configuration<\/option><option value='85'>Local Privilege Escalation (sendpage)<\/option><option value='86'>Local Privilege Escalation (udev)<\/option><option value='87'>Man-in-the-Middle Attack (HTTP)<\/option><option value='88'>Man-in-the-Middle Attack (SMTP)<\/option><option value='89'>Old/Backup & Unreferenced Files<\/option><option value='90'>Robots File<\/option><option value='91'>/<\/option><option value='92'>/ A6 - Sensitive Data Exposure /<\/option><option value='93'>Base64 Encoding (Secret)<\/option><option value='94'>BEAST/CRIME/BREACH Attacks<\/option><option value='95'>Clear Text HTTP (Credentials)<\/option><option value='96'>Heartbleed Vulnerability<\/option><option value='97'>Host Header Attack (Reset Poisoning)<\/option><option value='98'>HTML5 Web Storage (Secret)<\/option><option value='99'>POODLE Vulnerability<\/option><option value='100'>SSL 2.0 Deprecated Protocol<\/option><option value='101'>Text Files (Accounts)<\/option><option value='102'>/<\/option><option value='103'>/ A7 - Missing Functional Level Access Control /<\/option><option value='104'>Directory Traversal - Directories<\/option><option value='105'>Directory Traversal - Files<\/option><option value='106'>Host Header Attack (Cache Poisoning)<\/option><option value='107'>Host Header Attack (Reset Poisoning)<\/option><option value='108'>Local File Inclusion (SQLiteManager)<\/option><option value='109'>Remote & Local File Inclusion (RFI/LFI)<\/option><option value='110'>Restrict Device Access<\/option><option value='111'>Restrict Folder Access<\/option><option value='112'>Server Side Request Forgery (SSRF)<\/option><option value='113'>XML External Entity Attacks (XXE)<\/option><option value='114'>/<\/option><option value='115'>/ A8 - Cross-Site Request Forgery (CSRF) /<\/option><option value='116'>Cross-Site Request Forgery (Change Password)<\/option><option value='117'>Cross-Site Request Forgery (Change Secret)<\/option><option value='118'>Cross-Site Request Forgery (Transfer Amount)<\/option><option value='119'>/<\/option><option value='120'>/ A9 - Using Known Vulnerable Components /<\/option><option value='121'>Buffer Overflow (Local)<\/option><option value='122'>Buffer Overflow (Remote)<\/option><option value='123'>Drupal SQL Injection (Drupageddon)<\/option><option value='124'>Heartbleed Vulnerability<\/option><option value='125'>PHP CGI Remote Code Execution<\/option><option value='126'>PHP Eval Function<\/option><option value='127'>phpMyAdmin BBCode Tag XSS<\/option><option value='128'>Shellshock Vulnerability (CGI)<\/option><option value='129'>SQLiteManager Local File Inclusion<\/option><option value='130'>SQLiteManager PHP Code Injection<\/option><option value='131'>SQLiteManager XSS<\/option><option value='132'>/<\/option><option value='133'>/ A10 - Unvalidated Redirects & Forwards /<\/option><option value='134'>Unvalidated Redirects & Forwards (1)<\/option><option value='135'>Unvalidated Redirects & Forwards (2)<\/option><option value='136'>/<\/option><option value='137'>/ Other bugs... /<\/option><option value='138'>ClickJacking (Movie Tickets)<\/option><option value='139'>Client-Side Validation (Password)<\/option><option value='140'>HTTP Parameter Pollution<\/option><option value='141'>HTTP Response Splitting<\/option><option value='142'>HTTP Verb Tampering<\/option><option value='143'>Information Disclosure - Favicon<\/option><option value='144'>Information Disclosure - Headers<\/option><option value='145'>Information Disclosure - PHP version<\/option><option value='146'>Information Disclosure - Robots File<\/option><option value='147'>Insecure iFrame (Login Form)<\/option><option value='148'>Unrestricted File Upload<\/option><option value='149'>---------------------------  Extras  --------------------------<\/option><option value='150'>A.I.M. - No-authentication Mode<\/option><option value='151'>Client Access Policy File<\/option><option value='152'>Cross-Domain Policy File<\/option><option value='153'>Evil 666 Fuzzing Page<\/option><option value='154'>Manual Intervention Required!<\/option><option value='155'>Unprotected Admin Portal<\/option><option value='156'>We Steal Secrets... (html)<\/option><option value='157'>We Steal Secrets... (plain)<\/option><option value='158'>WSDL File (Web Services/SOAP)<\/option>\n\n        <\/select>\n        \n        <button type=\"submit\" name=\"form_bug\" value=\"submit\">Hack<\/button>\n        \n    <\/form>\n    \n<\/div>\n      \n<\/body>\n    \n<\/html>","cookieParams":"security_level=0; PHPSESSID=brt521snhl38f41cr4cs8ll0u2","requestBody":"entry=$attack_request&blog=submit&entry_add=","responseHeader":"HTTP/1.1 200 OK\r\nDate: Wed, 10 Apr 2019 09:49:34 GMT\r\nServer: Apache/2.4.7 (Ubuntu)\r\nX-Powered-By: PHP/5.5.9-1ubuntu4.14\r\nExpires: Thu, 19 Nov 1981 08:52:00 GMT\r\nCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\r\nPragma: no-cache\r\nVary: Accept-Encoding\r\nKeep-Alive: timeout=5, max=100\r\nConnection: Keep-Alive\r\nContent-Type: text/html\r\n\r\n","requestHeader":"POST http://0.0.0.0:32779/xss_stored_1.php HTTP/1.1\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:67.0) Gecko/20100101 Firefox/67.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nAccept-Language: de,en-US;q=0.7,en;q=0.3\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 109\r\nConnection: keep-alive\r\nReferer: http://0.0.0.0:32779/xss_stored_1.php\r\nCookie: security_level=0; PHPSESSID=brt521snhl38f41cr4cs8ll0u2\r\nUpgrade-Insecure-Requests: 1\r\nHost: 0.0.0.0:32779\r\n\r\n","id":"7007","type":"1","timestamp":"1554889774429","tags":["Comment","Form","Script"]}
"""

from urllib.parse import urlparse

def parse_response_body(response_body):
    print(type(response_body))
    response_body.lower().replace('\n', ' ').replace('\r', ' ')
    try:
        clean_text = BeautifulSoup(response_body, "html.parser")
        if clean_text:
            if clean_text.body:
                clean_text = clean_text.body
        return clean_text
    except:
        return response_body

def remove_multilines(multilines):
    return multilines.replace('\r\n', ' ')


# import urllib.parse
# from string import Template
# import json
# with open('data/xss_example.txt', 'r') as f:
#     message = json.load(f)
# template = message['responseBody']
# attacks = open("data/xss-payload-list.txt", "r")
# data = {}
# for attack in attacks:
#     print(attack)
#     message_id = hash(attack)
#     message['responseBody'] = Template(template).substitute(attack_response=attack, attack_request=urllib.parse.quote(attack))
#
#     message_content = {
#         'messageId': message_id,
#         'requestHeader': message['requestHeader'],
#         'requestBody': message['requestBody'],
#         'responseHeader': remove_multilines(message['responseHeader']),
#         'responseBody': parse_response_body(message['responseBody']),
#         'attacked': 0
#     }
#     data[message_id] = message_content
# print(data)
#print(parsed_data.keys())

from selenium import webdriver
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities

driver = webdriver.Remote(
   command_executor='http://127.0.0.1:4444/wd/hub',
   desired_capabilities=DesiredCapabilities.FIREFOX)

driver.get("http://www.python.org")
print(driver.title)
driver.close()